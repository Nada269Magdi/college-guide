config/db.js
const mysql = require('mysql2');

const db = mysql.createConnection({
    host: 'localhost',
    user: 'root',
    password: '',
    database: 'college_guide',
    port:'3306'
});

db.connect((err) => {
  if (err) {
    console.log('Database connection failed:', err);
  } else {
    console.log('Database connected successfully');
  }
});




module.exports = db;
________________________________________________________
controllers/authcontroller.js
const db = require('../config/db');

exports.register = (req, res) => {
    const { id, name, email, password } = req.body;
    const checkQuery = `SELECT * FROM user WHERE id = ?`;
    db.query(checkQuery, [id], (err, result) => {
        if (err){ 
            return res.status(500).json({ 
                message: 'Database error', 
                error: err 
            });
        }
        if (result.length > 0) {
            return res.status(400).json({
                message: 'User with this ID already exists' 
            });
        }
        const insertQuery = `INSERT INTO user (id, name, email, password) VALUES (?, ?, ?, ?)`;
        db.query(insertQuery, [id, name, email, password], (err2, result2) => {
            if (err2){ 
                return res.status(500).json({ 
                    message: 'Database error', 
                    error: err2 
                });
            }
            res.status(201).json({ 
                message: 'User registered successfully' 
            });
        });
    });
};
exports.login = (req, res) => {
  const { email, password } = req.body;

  const query = `SELECT * FROM user WHERE email = ? AND password = ?`;
  db.query(query, [email, password], (err, result) => {
    if (err) return res.status(500).json({ message: 'Database error', error: err });

    if (result.length === 0) {
      return res.status(400).json({ message: 'Invalid email or password' });
    }

    res.json({ message: 'Login successful', user: result[0] });
  });
};
________________________________________________________
routes/auth.js
const express = require('express');
const { register, login } = require('../controllers/authcontroller');
const router = express.Router();

router.post('/register', register);
router.post('/login', login);

module.exports = router;
________________________________________________________
routes/sendCode.js
const express = require("express");
const router = express.Router();
const sendEmail = require("../utils/sendEmail");

// temporary in-memory storage (later we can move to DB or Redis)
const codes = {};

router.post("/send-code", async (req, res) => {
  const { email } = req.body;

  if (!email) {
    return res.status(400).json({ message: "Email is required" });
  }

  // generate 6-digit code
  const code = Math.floor(100000 + Math.random() * 900000);

  // save code
  codes[email] = code;

  const sent = await sendEmail(
    email,
    "Verification Code",
    `<h2>Your verification code is:</h2><h1>${code}</h1>`
  );

  if (!sent) {
    return res.status(500).json({ message: "Failed to send email" });
  }

  res.json({ message: "Verification code sent successfully" });
});

module.exports = { router, codes };
________________________________________________________
routes/verifyCode.js
const express = require("express");
const router = express.Router();
const { codes } = require("./sendCode");

router.post("/verify-code", (req, res) => {
  const { email, code } = req.body;

  if (!email || !code) {
    return res.status(400).json({ message: "Email and code are required" });
  }

  if (codes[email] && codes[email] == code) {
    delete codes[email]; // remove after success
    return res.json({ message: "Code verified successfully" });
  }

  res.status(400).json({ message: "Invalid or expired code" });
});

module.exports = router;
________________________________________________________
utils/sendEmail.js
const nodemailer = require("nodemailer");

const sendEmail = async (to, subject, html) => {
  try {
    const transporter = nodemailer.createTransport({
      host: process.env.SMTP_HOST,
      port: process.env.SMTP_PORT,
      secure: false,
      auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASS,
      },
    });

    await transporter.sendMail({
      from: '"College Guide" <magdynadamagdy32@gmail.com>',
      to,
      subject,
      html,
    });

    return true;
  } catch (error) {
    console.error("Email error:", error);
    return false;
  }
};

module.exports = sendEmail;

________________________________________________________
index.js
require('dotenv').config();
const express = require('express');
const cors = require('cors');
const db = require('./config/db');
const authRoutes = require('./routes/auth');
const sendCodeRoute = require("./routes/sendCode");
const verifyCodeRoute = require("./routes/verifyCode");

const app = express();
app.use(cors());
app.use(express.json());
app.use("/api", sendCodeRoute.router);
app.use("/api", verifyCodeRoute);

app.use('/api/auth', authRoutes);

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Server listening on port ${PORT}`));
________________________________________________________
.env
JWT_SECRET=mysupersecret_local
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_USER=9e******@smtp-brevo.com
SMTP_PASS=***************
________________________________________________________
.gitignore
node_modules
.env
.DS_Store
npm-debug.log

________________________________________________________
